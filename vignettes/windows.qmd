---
title: "Windows Builds"
format:
  html:
    code-fold: true
editor: visual
engine: knitr
---

# Overview

This document attempts to track Windows builds for Bioconductor packages for the devel and release branches:

-   http://bioc.r-universe.dev builds the Bioconductor devel branch
-   http://bioc-release.r-universe.dev builds the Bioconductor release branch

Because R universe build for multiple versions of R whereas Bioconductor branches build for a specific version, the following tables display only the package builds corresponding the Bioconductor branch's specific R version.

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r library, eval = "hide", message = FALSE}

library(universe)
library(BiocPkgTools)
library(biocUniTools)
library(dplyr)
library(reactable)
library(tibble)

# set max.print to get all packages
options(max.print = 3000L)

r_version <- "4.6.0"
bioc_version <- "3.23"
uni <- "bioc"
uni_os_branch <- "devel"
ru_builds <- biocUniTools::get_uni_pkgs(uni, uni_os_branch, r_version,
                                        "windows", verbose = FALSE)
bbs_pkgs_i <- BiocPkgTools::biocBuildReport(version = bioc_version,
                                            pkgType = "software")
```

## Bioconductor Devel Windows on bioc.r-universe.dev

Note: The following packages may not have the same version or commit hash in
R Universe and the BBS. Only packages with the same version and commit hash
are currently propagated.

```{r devel-windows-results, message = FALSE}
bbs_builds <- bbs_pkgs_i |>
    dplyr::filter(node == "nebbiolo1", stage == "checksrc") |>
    dplyr::select(pkg, version, Deprecated, git_last_commit, result) |>
    dplyr::rename(Package = pkg, Version = version, BBS_commit = git_last_commit,
                  Check = result)

devel_builds <- merge(bbs_builds, ru_builds, by = "Package")
devel_builds <- devel_builds |>
  dplyr::rename(`RU Version` = `Version.x`, `BBS Version` = `Version.y`,
                `BBS Commit` = `BBS_commit`, `RU Commit` = `RU_commit`,
                `BBS Check` = Check, `RU Job Check` = JobCheck,
                `RU Binaries Check` = `BinariesCheck`,
                `RU Binary Status` = BinariesStatus, `Job Url` = JobUrl) |>
dplyr::select(Package, `RU Version`, `BBS Version`, `BBS Commit`, `RU Commit`,
              `BBS Check`, `RU Job Check`, `RU Binaries Check`,
              `RU Binary Status`, `Job Url`, Deprecated)

reactable::reactable(subset(devel_builds, select = -`Job Url`),
                     defaultPageSize = 50,
                     compact = TRUE,
                     columns = list(
                        `RU Job Check` = reactable::colDef(cell = function(value, index) {
                            if (is.na(value)) {
                                "No url"
                            } else {
                                htmltools::tags$a(href = devel_builds[index, "Job Url"],
                                                  target = "_blank",
                                                  as.character(value))
                            }}))
)

```

## Bioconductor Release Windows on bioc-release.r-universe.dev

Note: The following packages may not have the same version or commit hash in
R Universe and the BBS. Only packages with the same version and commit hash
are currently propagated.

```{r release-windows-results, message = FALSE}
r_version <- "4.5.0"
bioc_version <- "3.22"
uni <- "bioc-release"
uni_os_branch <- "release"
ru_builds <- biocUniTools::get_uni_pkgs(uni, uni_os_branch, r_version,
                                        "windows", verbose = FALSE)
bbs_pkgs_i <- BiocPkgTools::biocBuildReport(version = bioc_version,
                                            pkgType = "software")

bbs_builds <- bbs_pkgs_i |>
    dplyr::filter(node == "nebbiolo2", stage == "checksrc") |>
    dplyr::select(pkg, version, Deprecated, git_last_commit, result) |>
    dplyr::rename(Package = pkg, Version = version, BBS_commit = git_last_commit,
                  Check = result)

release_builds <- merge(bbs_builds, ru_builds, by = "Package")
release_builds <- release_builds |>
  dplyr::rename(`RU Version` = `Version.x`, `BBS Version` = `Version.y`,
                `BBS Commit` = `BBS_commit`, `RU Commit` = `RU_commit`,
                `BBS Check` = Check, `RU Job Check` = JobCheck,
                `RU Binaries Check` = `BinariesCheck`,
                `RU Binary Status` = BinariesStatus, `Job Url` = JobUrl) |>
dplyr::select(Package, `RU Version`, `BBS Version`, `BBS Commit`, `RU Commit`,
              `BBS Check`, `RU Job Check`, `RU Binaries Check`,
              `RU Binary Status`, `Job Url`, Deprecated)

reactable::reactable(subset(release_builds, select = -`Job Url`),
                     defaultPageSize = 50,
                     compact = TRUE,
                     columns = list(
                        `RU Job Check` = reactable::colDef(cell = function(value, index) {
                            if (is.na(value)) {
                                "No url"
                            } else {
                                htmltools::tags$a(href = release_builds[index, "Job Url"],
                                                  target = "_blank",
                                                  as.character(value))
                            }}))
)
```


### Understanding the error

For more details about the error, click on the link. The `Latest Check` will go to the latest GitHub Action Workflow run's `R CMD check` on the package whereas the `Binary Check` will go to the GitHub Action Workflow associated with the `R CMD check` associated with the binary. It may not take you to the specific location of the error. You need to look at the `Build R-release for Windows` (on left), which builds the same package version as Bioconductor devel for the correct version of R. You can then either expand the `Annotations` or expand `R CMD check` to see more details about the error. You must be logged in to see more details.

![annotations](images/annotations.png)

![r_cmd_check](images/r_cmd_check.png)

## sessionInfo()

```{r sessionInfo}
sessionInfo()
```
